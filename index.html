<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EduInsight AI â€” Assignment Analytics Dashboard</title>
  <meta name="description"
    content="AI-powered assignment analytics and intelligent feedback system for teachers. Identify common mistakes, surface trends, and draft actionable feedback." />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>

  <!-- â”€â”€ Navbar â”€â”€ -->
  <nav class="navbar">
    <a href="index.html" class="navbar-brand">
      <div class="logo-icon">ğŸ“Š</div>
      <span class="brand-name">EduInsight AI</span>
      <span class="ps-badge">PS5D146E</span>
    </a>
    <div class="nav-links">
      <a href="index.html" class="nav-link active"><span class="nav-icon">ğŸ </span> Dashboard</a>
      <a href="upload.html" class="nav-link"><span class="nav-icon">ğŸ“¤</span> Upload</a>
      <a href="analytics.html" class="nav-link"><span class="nav-icon">ğŸ”¬</span> Analytics</a>
      <a href="feedback.html" class="nav-link"><span class="nav-icon">âœï¸</span> Feedback</a>
      <button class="nav-link" style="background:none;border:none;cursor:pointer;" onclick="openSettings()"><span
          class="nav-icon">âš™ï¸</span> Settings</button>
    </div>
  </nav>

  <!-- â”€â”€ Settings Modal â”€â”€ -->
  <div id="settings-modal" class="modal-overlay hidden">
    <div class="modal-card">
      <div class="modal-header">
        <div class="card-title">âš™ï¸ System Settings</div>
        <button class="btn-close" onclick="closeSettings()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="form-group mb-16">
          <label class="form-label">Google Gemini API Key</label>
          <input type="password" id="gemini-key-input" class="form-control" placeholder="Paste your API key here...">
          <p class="form-hint">Used for deep mistake analysis and intelligent feedback generation. <a
              href="https://aistudio.google.com/app/apikey" target="_blank">Get a free key here.</a></p>
        </div>
        <div
          style="background:rgba(124,58,237,0.1); padding:12px; border-radius:8px; border-left:4px solid var(--purple-500);">
          <small style="color:var(--text-secondary);">Your key is stored locally in your browser and never sent to our
            servers.</small>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeSettings()">Cancel</button>
        <button class="btn btn-primary" onclick="saveSettings()">Save Configuration</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Toast â”€â”€ -->
  <div id="toast-container"></div>



  <!-- â”€â”€ Hero â”€â”€ -->
  <div class="hero">
    <div class="hero-tag">
      <span class="pulse-dot"></span>
      AI-Powered Analytics â€” Hackathon Edition
    </div>
    <h1>Turn Assignments Into<br>Actionable Insights</h1>
    <p>Analyze student submissions at scale. Detect common mistakes, surface performance trends, and draft meaningful
      feedback â€” all in one place.</p>
    <div class="hero-actions">
      <a href="upload.html" class="btn btn-primary btn-lg">ğŸ“¤ Upload Submissions</a>
      <a href="analytics.html" class="btn btn-secondary btn-lg">ğŸ”¬ View Analytics</a>
    </div>
  </div>

  <div class="page-wrapper">

    <!-- â”€â”€ Stats â”€â”€ -->
    <div class="stats-grid" id="stats-grid">
      <div class="stat-card stat-purple">
        <div class="stat-icon">ğŸ“š</div>
        <div>
          <div class="stat-value" id="stat-assignments">0</div>
          <div class="stat-label">Assignments</div>
          <div class="stat-change text-muted">Total ingested</div>
        </div>
      </div>
      <div class="stat-card stat-cyan">
        <div class="stat-icon">ğŸ‘¥</div>
        <div>
          <div class="stat-value" id="stat-submissions">0</div>
          <div class="stat-label">Submissions</div>
          <div class="stat-change text-muted">Student responses</div>
        </div>
      </div>
      <div class="stat-card stat-green">
        <div class="stat-icon">ğŸ”</div>
        <div>
          <div class="stat-value" id="stat-insights">0</div>
          <div class="stat-label">Insights Found</div>
          <div class="stat-change text-muted">Common mistakes detected</div>
        </div>
      </div>
      <div class="stat-card stat-pink">
        <div class="stat-icon">âœï¸</div>
        <div>
          <div class="stat-value" id="stat-feedback">0</div>
          <div class="stat-label">Feedback Drafts</div>
          <div class="stat-change text-muted">Ready to review</div>
        </div>
      </div>
    </div>

    <div class="grid-2">
      <!-- â”€â”€ Assignments list â”€â”€ -->
      <div>
        <div class="section-header">
          <div class="section-title">
            <div class="title-icon">ğŸ“š</div>
            Assignments
          </div>
          <a href="upload.html" class="btn btn-primary btn-sm">+ New</a>
        </div>
        <div id="assignments-list">
          <div class="empty-state">
            <div class="empty-icon">ğŸ“‚</div>
            <h3>No assignments yet</h3>
            <p>Upload your first batch of student submissions to get started.</p>
            <a href="upload.html" class="btn btn-primary">Upload Now</a>
          </div>
        </div>
      </div>

      <!-- â”€â”€ Activity feed â”€â”€ -->
      <div>
        <div class="section-header">
          <div class="section-title">
            <div class="title-icon">ğŸ•’</div>
            Recent Activity
          </div>
          <button class="btn btn-secondary btn-sm" onclick="clearActivity()">Clear</button>
        </div>
        <div class="activity-feed" id="activity-feed">
          <div class="empty-state">
            <div class="empty-icon">ğŸ“‹</div>
            <h3>No activity yet</h3>
            <p>Actions you take will appear here.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ How it works â”€â”€ -->
    <div class="divider"></div>
    <div class="section-header">
      <div class="section-title">
        <div class="title-icon">âš¡</div>
        How It Works
      </div>
    </div>
    <div class="grid-3">
      <div class="card" style="text-align:center;">
        <div style="font-size:36px;margin-bottom:12px;">ğŸ“¤</div>
        <div class="card-title">1. Upload Submissions</div>
        <div class="card-subtitle">Upload PDF or paste student responses manually. Auto-grouped by question.</div>
      </div>
      <div class="card" style="text-align:center;">
        <div style="font-size:36px;margin-bottom:12px;">ğŸ¤–</div>
        <div class="card-title">2. AI Analysis</div>
        <div class="card-subtitle">TF-IDF + cosine clustering detects common mistakes & concept gaps with confidence
          scores.</div>
      </div>
      <div class="card" style="text-align:center;">
        <div style="font-size:36px;margin-bottom:12px;">âœï¸</div>
        <div class="card-title">3. Edit & Export</div>
        <div class="card-subtitle">Review AI-drafted feedback, approve or reject each insight, then export as PDF or
          text.</div>
      </div>
    </div>

    <!-- â”€â”€ Explainability blurb â”€â”€ -->
    <div class="divider"></div>
    <div class="card mt-12" style="display:flex;gap:20px;align-items:flex-start;flex-wrap:wrap;">
      <div style="font-size:40px;">ğŸ”</div>
      <div>
        <div class="card-title" style="font-size:18px;">Full Transparency â€” No Black Boxes</div>
        <div class="card-subtitle" style="margin-bottom:0;">
          Every AI insight is backed by real student responses, shown inline.
          Confidence scores indicate how prevalent each pattern is.
          Teachers retain full control â€” approve, reject, or rewrite any draft.
          <br><br>
          <span class="badge badge-purple">TF-IDF Extraction</span>
          <span class="badge badge-cyan" style="margin-left:6px;">Cosine Similarity</span>
          <span class="badge badge-green" style="margin-left:6px;">N-gram Clustering</span>
          <span class="badge badge-amber" style="margin-left:6px;">Confidence Scoring</span>
        </div>
      </div>
    </div>

  </div>

  <script src="js/storage.js"></script>

  <script>
    Storage.seedDemoData();

    function timeSince(ts) {
      const diff = Date.now() - ts;
      const m = Math.floor(diff / 60000);
      const h = Math.floor(m / 60);
      const d = Math.floor(h / 24);
      if (d > 0) return `${d}d ago`;
      if (h > 0) return `${h}h ago`;
      if (m > 0) return `${m}m ago`;
      return 'Just now';
    }

    function showToast(msg, type = 'info') {
      const el = document.createElement('div');
      el.className = `toast toast-${type}`;
      el.innerHTML = `<span>${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}</span><span>${msg}</span>`;
      document.getElementById('toast-container').appendChild(el);
      setTimeout(() => el.classList.add('show'), 10);
      setTimeout(() => { el.classList.remove('show'); setTimeout(() => el.remove(), 300); }, 3500);
    }

    function clearActivity() {
      localStorage.setItem(Storage.KEYS.ACTIVITY, '[]');
      renderActivity();
      showToast('Activity log cleared', 'info');
    }

    function renderStats() {
      const s = Storage.getStats();
      document.getElementById('stat-assignments').textContent = s.assignments;
      document.getElementById('stat-submissions').textContent = s.submissions;
      document.getElementById('stat-insights').textContent = s.insights;
      document.getElementById('stat-feedback').textContent = s.feedbackDrafts;
    }

    function renderAssignments() {
      const list = document.getElementById('assignments-list');
      const assignments = Storage.getAssignments();
      if (assignments.length === 0) {
        list.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“‚</div><h3>No assignments yet</h3><p>Upload your first batch of student submissions to get started.</p><a href="upload.html" class="btn btn-primary">Upload Now</a></div>`;
        return;
      }
      list.innerHTML = assignments.map(a => {
        const subs = Storage.getSubmissions(a.id);
        const hasInsights = Storage.getInsights(a.id) !== null;
        return `
      <div class="card mb-8" style="display:flex;align-items:center;gap:14px;padding:16px;margin-bottom:10px;">
        <div style="font-size:28px;">ğŸ“‹</div>
        <div style="flex:1;min-width:0;">
          <div class="card-title" style="margin-bottom:2px;">${a.title}</div>
          <div style="font-size:12px;color:var(--text-secondary);">${a.subject} Â· ${subs.length} submissions Â· ${timeSince(a.createdAt)}</div>
        </div>
        <div style="display:flex;gap:6px;flex-wrap:wrap;">
          ${hasInsights
            ? `<a href="analytics.html?id=${a.id}" class="btn btn-sm btn-secondary">ğŸ”¬ Analytics</a>
               <a href="feedback.html?id=${a.id}"  class="btn btn-sm btn-primary" >âœï¸ Feedback</a>`
            : `<a href="analytics.html?id=${a.id}" class="btn btn-sm btn-primary" >ğŸ”¬ Analyze Now</a>`}
          <button class="btn btn-sm btn-secondary" onclick="deleteAssignment('${a.id}')" title="Delete">ğŸ—‘ï¸</button>
        </div>
      </div>`;
      }).join('');
    }

    function deleteAssignment(id) {
      if (!confirm('Delete this assignment and all its data?')) return;
      Storage.deleteAssignment(id);
      Storage.clearSubmissions(id);
      Storage.logActivity('Assignment deleted', 'warn');
      renderStats();
      renderAssignments();
      showToast('Assignment deleted.', 'info');
    }

    function renderActivity() {
      const feed = document.getElementById('activity-feed');
      const logs = Storage.getActivity();
      if (logs.length === 0) {
        feed.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“‹</div><h3>No activity yet</h3><p>Actions you take will appear here.</p></div>`;
        return;
      }
      const dotMap = { success: 'dot-success', info: 'dot-info', warn: 'dot-warn', error: 'dot-error' };
      feed.innerHTML = logs.slice(0, 12).map(l => `
      <div class="activity-item">
        <div class="dot ${dotMap[l.type] || 'dot-info'}"></div>
        <div style="flex:1;">${l.msg}</div>
        <div class="ts">${timeSince(l.ts)}</div>
      </div>`).join('');
    }

    // â”€â”€ Settings â”€â”€
    function openSettings() {
      const settings = Storage.getSettings();
      document.getElementById('gemini-key-input').value = settings.geminiKey || '';
      document.getElementById('settings-modal').classList.remove('hidden');
    }

    function closeSettings() {
      document.getElementById('settings-modal').classList.add('hidden');
    }

    function saveSettings() {
      const key = document.getElementById('gemini-key-input').value.trim();
      Storage.saveSettings({ geminiKey: key });
      showToast('Settings saved successfully', 'success');
      closeSettings();
    }

    renderStats();
    renderAssignments();
    renderActivity();

    // Auto-open settings if requested
    if (new URLSearchParams(window.location.search).get('settings') === 'true') {
      openSettings();
    }
  </script>
</body>

</html>